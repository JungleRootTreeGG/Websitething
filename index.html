<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SMC Shipping Ordering System</title>
<style>
body { 
  margin:0; 
  font-family: system-ui, sans-serif; 
  background:#121212; 
  color:#eee;
}

iframe { 
  width: 100%; 
  height: 500px; 
  border: none; 
  display:block;
}

.order-section {
  padding: 20px;
  max-width: 800px;
  margin: 20px auto;
  background:#1e1e1e;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.7);
}

.order-section h2 { 
  margin-top:0; 
  color:#00bcd4;
}

.order-section form label { 
  display:block; 
  margin-bottom: 10px; 
}

.order-section form input, 
.order-section form select, 
.order-section form textarea {
  width: 90%;
  padding: 6px 10px;
  border-radius: 6px;
  border: 1px solid #555;
  background:#2b2b2b;
  color:#eee;
}

.order-section form small {
  display:block;
  font-size: 0.85em;
  color:#aaa;
  margin-bottom:10px;
}

.order-section form button {
  margin-top: 15px;
  padding: 10px 20px;
  border:none;
  border-radius: 6px;
  background:#00bcd4;
  color:#fff;
  font-size:16px;
  cursor:pointer;
}

.order-section form button:hover { 
  background:#0098aa; 
}

.container-info {
  margin-top:20px;
  background:#2b2b2b;
  padding:10px;
  border-radius:8px;
  border:1px solid #555;
}

.container-info img {
  max-width:100%;
  display:block;
  margin:10px 0;
  border-radius:6px;
}

.container-info ul {
  margin:0;
  padding-left:20px;
}
</style>
</head>
<body>

<iframe src="map.html" id="mapFrame"></iframe>

<div class="order-section">
  <h2>Place Your Shipping Order</h2>
  <form id="orderForm">
    <label>From Port:
      <input type="text" id="fromPort" readonly required>
    </label>

    <label>To Port:
      <input type="text" id="toPort" readonly required>
    </label>

    <label>Discord Username:
      <input type="text" id="discord" required>
    </label>

    <label>In-game Username:
      <input type="text" id="ingame" required>
    </label>

    <label>Cargo Value ($):
      <input type="number" id="cargoValue" min="0" value="0" required>
    </label>

    <label>Container Type:
      <select id="containerType" required>
        <option value="Civilian">Civilian</option>
        <option value="Military">Military</option>
      </select>
    </label>

    <div id="militaryNationContainer" style="display:none; margin-bottom:10px;">
      <label>Nation:
        <input type="text" id="militaryNation" placeholder="Enter your nation" required>
      </label>
    </div>

    <label>Container Number:
      <input type="text" id="containerNumber" placeholder="UAE 1234" required pattern="[A-Z]{3} \d{4}">
    </label>
    <small>Must be 3 capital letters followed by 4 digits (e.g., UAE 1234)</small>

    <label>Optional Comment:
      <textarea id="orderComment" rows="3" placeholder="Add a comment (optional)"></textarea>
    </label>

    <label>Total Price ($):
      <input type="text" id="totalPrice" readonly>
    </label>

    <button type="submit" id="submitBtn">Submit Order</button>
  </form>

  <div class="container-info">
    <h3>Container Requirements</h3>
    <p>Containers must follow these rules:</p>
    <ul>
      <li>Dimensions: 10 blocks long, 3 blocks wide, 5 blocks high</li>
      <li>Max 9 barrels or chests inside</li>
      <li>Must contain an iron door with a lever inside to seal the container</li>
      <li>A sign with the container number must be placed inside</li>
    </ul>
    <img src="https://i.postimg.cc/D0fp4QVg/3e88a5dc-5e2c-4157-af89-b859171ddbb0.png" alt="Container Example exterior">
    <img src="https://i.postimg.cc/rwRn4Fbp/6877b029-e017-49bf-aa81-0be269b7a1d1.png" alt="Container Example exterior">
    <img src="https://i.postimg.cc/5N6nc2fN/cd0a5ad6-4455-431d-925a-39826f16dbf8.png" alt="Container Example interior">
  </div>
</div>

<script>
let routePortNames = [];

const containerTypeSelect = document.getElementById('containerType');
const militaryNationContainer = document.getElementById('militaryNationContainer');

containerTypeSelect.addEventListener('change', () => {
  militaryNationContainer.style.display = containerTypeSelect.value === "Military" ? "block" : "none";
  calculatePrice(); // recalc price if type changes
});

window.addEventListener('message', (event) => {
  const data = event.data;
  if(data && data.startPort && data.endPort && Array.isArray(data.portsAlongRoute)){
    routePortNames = data.portsAlongRoute;
    document.getElementById('fromPort').value = data.startPort;
    document.getElementById('toPort').value = data.endPort;
    calculatePrice();
  }
});

function calculatePrice(){
  const cargoValue = parseFloat(document.getElementById('cargoValue').value) || 0;
  const containerType = containerTypeSelect.value;
  const baseFee = containerType === "Military" ? 2000 : 1000;
  const totalPrice = baseFee + cargoValue * 0.1;
  document.getElementById('totalPrice').value = totalPrice.toFixed(2);
}

document.getElementById('cargoValue').addEventListener('input', calculatePrice);

document.getElementById('orderForm').addEventListener('submit', async (e)=>{
  e.preventDefault();

  const submitBtn = document.getElementById('submitBtn');
  submitBtn.disabled = true;
  submitBtn.textContent = "Sending...";

  const containerNumber = document.getElementById('containerNumber').value.trim();
  const regex = /^[A-Z]{3} \d{4}$/;

  if(!regex.test(containerNumber)){
    alert("Container number is invalid! Must be 3 capital letters followed by 4 digits (e.g., UAE 1234).");
    submitBtn.disabled = false;
    submitBtn.textContent = "Submit Order";
    return;
  }

  if(routePortNames.length === 0){
    alert("Please select a route on the map first!");
    submitBtn.disabled = false;
    submitBtn.textContent = "Submit Order";
    return;
  }

  const orderData = {
    fromPort: document.getElementById('fromPort').value,
    toPort: document.getElementById('toPort').value,
    discord: document.getElementById('discord').value,
    ingame: document.getElementById('ingame').value,
    cargoValue: parseFloat(document.getElementById('cargoValue').value),
    containerType: containerTypeSelect.value,
    containerNumber: containerNumber,
    totalPrice: parseFloat(document.getElementById('totalPrice').value),
    portsAlongRoute: routePortNames,
    nation: containerTypeSelect.value === "Military" ? document.getElementById('militaryNation').value : null,
    comment: document.getElementById('orderComment').value || null
  };

  const webhookURL = "https://discord.com/api/webhooks/1463234591706976543/1wTw6W8jXRmiOMTNjzbilt4AJxPGVmC4FTbPt3OQGvN3TRgRuAbQN75V0Q7jlOTToT4o";

  let content = `ðŸ“¦ **New Shipping Order**
**From:** ${orderData.fromPort}
**To:** ${orderData.toPort}
**Discord:** ${orderData.discord}
**In-game Username:** ${orderData.ingame}
**Cargo Value:** $${orderData.cargoValue.toFixed(2)}
**Container:** ${orderData.containerType} (#${orderData.containerNumber})`;

  if(orderData.nation) content += `\n**Nation:** ${orderData.nation}`;
  if(orderData.comment) content += `\n**Comment:** ${orderData.comment}`;

  content += `\n**Stops:** ${orderData.portsAlongRoute.join(' â†’ ')}
**Total Price:** $${orderData.totalPrice.toFixed(2)}`;

  try {
    const response = await fetch(webhookURL, {
      method: 'POST',
      headers: { 'Content-Type':'application/json' },
      body: JSON.stringify({ content })
    });
    if(response.ok){
      alert('Order sent successfully!');
    } else {
      alert('Failed to send order to Discord.');
    }
  } catch(err){
    console.error(err);
    alert('Network error. Could not send order.');
  }

  submitBtn.disabled = false;
  submitBtn.textContent = "Submit Order";
});
</script>

</body>
</html>
