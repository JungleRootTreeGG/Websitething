<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Baltic Shipping Order SMC</title>

<style>
/* ===== BASE ===== */
body {
  margin: 0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background: #121212;
  color: #e6e6e6;
}

/* ===== MAP ===== */
iframe {
  width: 100%;
  height: 500px;
  border: none;
  display: block;
  background: #000;
}

/* ===== MAIN CARD ===== */
.order-section {
  max-width: 900px;
  margin: 24px auto;
  padding: 24px;
  background: #1b1b1b;
  border-radius: 14px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.6);
}

.order-section h2 {
  margin-top: 0;
  margin-bottom: 16px;
  color: #00bcd4;
  font-weight: 600;
}

/* ===== FORM ===== */
form label {
  display: block;
  margin-bottom: 12px;
}

form input,
form select,
form textarea {
  width: 100%;
  padding: 8px 10px;
  border-radius: 8px;
  border: 1px solid #444;
  background: #262626;
  color: #eee;
  box-sizing: border-box;
}

form textarea {
  resize: vertical;
}

form small {
  display: block;
  margin-bottom: 12px;
  font-size: 0.85em;
  color: #aaa;
}

form button {
  margin-top: 18px;
  padding: 12px 22px;
  border: none;
  border-radius: 8px;
  background: #00bcd4;
  color: #000;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
}

form button:hover {
  background: #0098aa;
}

/* ===== CONTAINER INFO ===== */
.container-info {
  margin-top: 28px;
  padding: 16px;
  background: #242424;
  border-radius: 10px;
  border: 1px solid #3a3a3a;
}

.container-info h3 {
  margin-top: 0;
  color: #00bcd4;
}

.container-info ul {
  margin: 0;
  padding-left: 18px;
}

.container-info img {
  max-width: 100%;
  margin-top: 12px;
  border-radius: 8px;
  border: 1px solid #333;
}
</style>
</head>

<body>

<!-- MAP -->
<iframe src="map.html" id="mapFrame"></iframe>

<div class="order-section">
  <h2>Place Your Shipping Order</h2>

  <form id="orderForm">

    <label>From Port:
      <input type="text" id="fromPort" readonly required>
    </label>

    <label>To Port:
      <input type="text" id="toPort" readonly required>
    </label>

    <label>Discord Username:
      <input type="text" id="discord" required>
    </label>

    <label>In-game Username:
      <input type="text" id="ingame" required>
    </label>

    <label>Cargo Value ($):
      <input type="number" id="cargoValue" min="0" value="0" required>
    </label>

    <label>Container Type:
      <select id="containerType" required>
        <option value="Civilian">Civilian</option>
        <option value="Military">Military</option>
      </select>
    </label>

    <div id="militaryNationContainer" style="display:none;">
      <label>Nation:
        <input type="text" id="militaryNation">
      </label>
    </div>

    <label>Container Number:
      <input type="text" id="containerNumber"
             placeholder="NBO 1234"
             required
             pattern="[A-Z]{3} \d{4}">
    </label>
    <small>Format: 3 capital letters + space + 4 digits</small>

    <label>Optional Comment:
      <textarea id="orderComment" rows="3"></textarea>
    </label>

    <label>Total Price ($):
      <input type="text" id="totalPrice" readonly>
    </label>
    <small>Pay at the port</small>
    
    <button type="submit" id="submitBtn">Submit Order</button>
  </form>

  <div class="container-info">
    <h3>Container Requirements</h3>
    <ul>
      <li>10 blocks long Ã— 3 blocks wide Ã— 5 blocks high</li>
      <li>Maximum 9 barrels or chests</li>
      <li>Iron door with lever inside for sealing</li>
      <li>Sign inside with container number, origin and destination</li>
    </ul>

    <img src="https://i.postimg.cc/D0fp4QVg/3e88a5dc-5e2c-4157-af89-b859171ddbb0.png">
    <img src="https://i.postimg.cc/rwRn4Fbp/6877b029-e017-49bf-aa81-0be269b7a1d1.png">
    <img src="https://i.postimg.cc/5N6nc2fN/cd0a5ad6-4455-431d-925a-39826f16dbf8.png">
  </div>
</div>

<script>
/* ===== ROUTE PRICES (EDIT HERE) ===== */
const routePrices = {
  "Konigsberg|London": 3500,
  "London|Miami": 5000,
  "Konigsberg|Miami": 8000
};

let routePortNames = [];

const containerTypeSelect = document.getElementById('containerType');
const militaryNationContainer = document.getElementById('militaryNationContainer');

containerTypeSelect.addEventListener('change', () => {
  militaryNationContainer.style.display =
    containerTypeSelect.value === "Military" ? "block" : "none";
  calculatePrice();
});

/* ===== MAP MESSAGE ===== */
window.addEventListener('message', (event) => {
  const d = event.data;
  if (d && d.startPort && d.endPort && Array.isArray(d.portsAlongRoute)) {
    routePortNames = d.portsAlongRoute;
    fromPort.value = d.startPort;
    toPort.value = d.endPort;
    calculatePrice();
  }
});

const cargoValueInput = document.getElementById('cargoValue');
const fromPort = document.getElementById('fromPort');
const toPort = document.getElementById('toPort');
const totalPrice = document.getElementById('totalPrice');

cargoValueInput.addEventListener('input', calculatePrice);

/* ===== PRICE CALC ===== */
function calculatePrice() {
  const cargoValue = parseFloat(document.getElementById('cargoValue').value) || 0;
  const from = fromPort.value;
  const to = toPort.value;

  if (!from || !to) {
    totalPrice.value = "";
    return;
  }

  // Normalize route key (directionless)
  const routeKey = [from, to].sort().join("|");

  const routeCost = routePrices[routeKey];

  if (routeCost === undefined) {
    totalPrice.value = "N/A";
    return;
  }

  const total = routeCost + cargoValue * 0.10;
  totalPrice.value = total.toFixed(2);
}

/* ===== SUBMIT FORM & DISCORD WEBHOOK ===== */
document.getElementById('orderForm').addEventListener('submit', async (e) => {
  e.preventDefault();

  const submitBtn = document.getElementById('submitBtn');
  submitBtn.disabled = true;
  submitBtn.textContent = "Sending...";

  // Validate route
  if (!routePortNames.length) {
    alert("Please select a route on the map first.");
    submitBtn.disabled = false;
    submitBtn.textContent = "Submit Order";
    return;
  }

  // Validate container number
  const containerNumber = document.getElementById('containerNumber').value.trim();
  const regex = /^[A-Z]{3} \d{4}$/;
  if (!regex.test(containerNumber)) {
    alert("Container number is invalid! Format: 3 capital letters + space + 4 digits (e.g., NBO 1234).");
    submitBtn.disabled = false;
    submitBtn.textContent = "Submit Order";
    return;
  }

  const orderData = {
    fromPort: fromPort.value,
    toPort: toPort.value,
    discord: document.getElementById('discord').value,
    ingame: document.getElementById('ingame').value,
    cargoValue: parseFloat(cargoValueInput.value),
    containerType: containerTypeSelect.value,
    containerNumber,
    totalPrice: parseFloat(totalPrice.value),
    nation: containerTypeSelect.value === "Military" ? document.getElementById('militaryNation').value : null,
    comment: document.getElementById('orderComment').value || null
  };

  // Discord webhook URL
  const webhookURL = "https://discord.com/api/webhooks/1463234591706976543/1wTw6W8jXRmiOMTNjzbilt4AJxPGVmC4FTbPt3OQGvN3TRgRuAbQN75V0Q7jlOTToT4o";

  let content = `ðŸ“¦ **New Shipping Order**
**From:** ${orderData.fromPort}
**To:** ${orderData.toPort}
**Discord:** ${orderData.discord}
**In-game Username:** ${orderData.ingame}
**Cargo Value:** $${orderData.cargoValue.toFixed(2)}
**Container:** ${orderData.containerType} (#${orderData.containerNumber})`;

  if (orderData.nation) content += `\n**Nation:** ${orderData.nation}`;
  if (orderData.comment) content += `\n**Comment:** ${orderData.comment}`;

**Total Price:** $${orderData.totalPrice.toFixed(2)}`;

  try {
    const response = await fetch(webhookURL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ content })
    });

    if (response.ok) {
      alert("Order sent successfully!");
      document.getElementById('orderForm').reset();
      totalPrice.value = "";
    } else {
      alert("Failed to send order to Discord.");
    }
  } catch (err) {
    console.error(err);
    alert("Network error. Could not send order.");
  }

  submitBtn.disabled = false;
  submitBtn.textContent = "Submit Order";
});
</script>
